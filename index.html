<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alex & Jeff | Tuscany 2026</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&family=Montserrat:wght@300;400;500&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-color: #F7F9F7; /* Off-white/cream */
            --primary-green: #8DA399; /* Pastel Sage */
            --dark-green: #2F3E32; /* Text color */
            --accent-light: #E8EFE8;
            --white: #FFFFFF;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background-color: var(--bg-color);
            color: var(--dark-green);
            font-family: 'Montserrat', sans-serif;
            line-height: 1.6;
        }

        h1, h2, h3, h4 {
            font-family: 'Cormorant Garamond', serif;
            font-weight: 600;
            color: var(--dark-green);
        }

        /* --- Login Overlay --- */
        #login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--bg-color);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }

        .login-box {
            background: var(--white);
            padding: 40px;
            border: 1px solid var(--primary-green);
            text-align: center;
            max-width: 400px;
            width: 100%;
            box-shadow: 0 4px 15px rgba(141, 163, 153, 0.2);
        }

        input[type="text"] {
            padding: 10px;
            width: 80%;
            margin-top: 15px;
            border: 1px solid #ccc;
            font-family: 'Montserrat', sans-serif;
            text-transform: uppercase;
        }

        button {
            margin-top: 15px;
            padding: 10px 25px;
            background-color: var(--primary-green);
            color: white;
            border: none;
            cursor: pointer;
            font-family: 'Montserrat', sans-serif;
            letter-spacing: 1px;
            transition: background 0.3s;
        }

        button:hover {
            background-color: var(--dark-green);
        }

        /* --- Main Layout --- */
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 20px;
        }

        header {
            text-align: center;
            padding: 60px 0 40px;
            border-bottom: 1px solid var(--primary-green);
            margin-bottom: 40px;
        }

        header h1 {
            font-size: 3.5rem;
            margin-bottom: 10px;
        }

        header p {
            font-size: 1.2rem;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .section {
            margin-bottom: 60px;
            text-align: center;
        }

        .greeting {
            font-size: 1.5rem;
            font-family: 'Cormorant Garamond', serif;
            margin-bottom: 20px;
        }

        .content-block {
            background: var(--white);
            padding: 30px;
            border-radius: 4px;
            border: 1px solid var(--accent-light);
        }

        /* --- Images --- */
        .img-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 30px 0;
        }

        .img-single {
            margin: 30px 0;
        }

        img {
            width: 100%;
            height: auto;
            border-radius: 2px;
        }

        /* Special Crop Logic for Outfit Image */
        .outfit-image-container {
            width: 100%;
            overflow: hidden;
            margin: 20px 0;
        }

        .outfit-img {
            width: 100%;
            height: auto;
            display: block;
        }

        /* Desktop Crop */
        @media (min-width: 768px) {
            .outfit-img {
                height: 400px;
                object-fit: cover;
                object-position: bottom; /* Crops the top */
            }

            /* Increase travel spacing on desktop */
            .travel-grid { gap: 40px; }
            
            /* Make itinerary images slightly wider than timeline text on desktop */
            .img-single img {
                max-width: 500px; /* timeline max-width is 600px; images now slightly wider */
                margin: 0 auto;
                display: block;
            }
        }

        /* --- Typography Tweaks --- */
        a {
            color: var(--primary-green);
            text-decoration: none;
            font-weight: 500;
        }
        
        a:hover {
            text-decoration: underline;
        }

        ul.timeline {
            list-style: none;
            text-align: left;
            padding: 0;
            display: inline-block;
            max-width: 600px;
        }

        .timeline li {
            padding: 15px 0;
            border-bottom: 1px solid var(--accent-light);
        }

        .timeline strong {
            color: var(--primary-green);
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.2rem;
            display: block;
        }

        .note {
            font-size: 0.9rem;
            color: #666;
            font-style: italic;
            margin-top: 10px;
        }

        .hidden-content {
            display: none; /* Controlled by JS */
            margin-top: 15px;
            background-color: var(--accent-light);
            padding: 15px;
            border-radius: 4px;
        }

        /* --- Footer --- */
        footer {
            text-align: center;
            padding: 40px 0;
            font-size: 0.8rem;
            color: #888;
            margin-top: 60px;
            border-top: 1px solid var(--primary-green);
        }

        /* --- RSVP Modal (removed) --- */
        .rsvp-modal {
            position: fixed;
            inset: 0;
            display: none;
            align-items: center;
            justify-content: center;
            background: rgba(0,0,0,0.45);
            z-index: 2000;
            padding: 20px;
        }
        .rsvp-modal-content {
            background: var(--white);
            width: 100%;
            max-width: 900px;
            height: 80vh;
            border-radius: 6px;
            overflow: hidden;
            position: relative;
        }
        .rsvp-close {
            position: absolute;
            right: 12px;
            top: 12px;
            background: var(--primary-green);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            z-index: 10;
        }
        @media (max-width: 768px) {
            .rsvp-modal-content { height: 85vh; }
            /* ...existing code... */
        }

        /* --- RSVP inline embed (new) --- */
        .rsvp-embed {
            width: 100%;
            max-width: 900px;
            margin: 20px auto;
            border-radius: 6px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            padding-top: 20px; /* <-- added 20px padding at top */
            box-sizing: border-box;
            background-color: #e4f3e5; /* <-- new: color for the padding area */
        }
        .rsvp-embed iframe {
            width: 100%;
            height: calc(1300px - 20px); /* subtract padding so total visual height is unchanged */
            min-height: calc(1300px - 20px);
            border: none;
            display: block;
        }

        /* Stack The Stay images on mobile only */
        @media (max-width: 768px) {
            .stay-img-grid { grid-template-columns: 1fr; }
        }

        /* Stack travel items on mobile */
        @media (max-width: 768px) {
            .travel-grid { grid-template-columns: 1fr; }
        }

        /* Mobile font adjustments: make fonts just a tiny bit smaller */
        @media (max-width: 768px) {
            body {
                font-size: 0.95rem; /* slight reduction */
            }
            header h1 {
                font-size: 2.6rem; /* reduced from 3.5rem */
            }
            header p {
                font-size: 1.05rem; /* reduced from 1.2rem */
            }
            .greeting {
                font-size: 1.3rem; /* reduced from 1.5rem */
            }
            ul.timeline {
                font-size: 0.95rem; /* slightly smaller timeline text */
            }

            /* Put location on its own line in the header */
            header p span.location { display: block; margin-top: 6px; }

            /* Make stay titles appear on their own line */
            .stay-line strong { display: block; margin-bottom: 2px; margin-top: 10px; }

            /* Extra spacing under getting there / getting back on mobile */
            .travel-grid > div { padding-bottom: 20px; }

        }

        /* Make the itinerary small note much smaller */
        .itinerary-note { font-size: 0.8rem; margin-top:6px; font-style:italic; color:#888; }

        /* Mobile helper: force a break on small screens */
        .mobile-break { display: inline; }
        @media (max-width: 768px) {
            .mobile-break { display: block; }
        }

    </style>
</head>
<body>

    <!-- LOGIN OVERLAY (Shows if no ID present) -->
    <div id="login-overlay">
        <div class="login-box">
            <h2>Welcome</h2>
            <p>Please enter your Guest ID found on your invitation.</p>
            <!-- changed placeholder to a fake ID following the 6-char pattern -->
            <input type="text" id="guest-id-input" placeholder="e.g. D4F6GH">
            <button onclick="submitId()">Enter</button>
            <p id="error-msg" style="color:red; display:none; margin-top:10px; font-size:0.9rem;">Invalid ID</p>
        </div>
    </div>

    <!-- MAIN WEBSITE CONTENT -->
    <div class="container">
        <header>
            <h1>Alex & Jeff</h1>
            <p><span class="date">September 15, 2026</span> <span class="location">&bull; Tuscany, Italy</span></p>
        </header>

        <section class="section">
            <div class="greeting" id="greeting-text">Hello, Guest</div>
            <p>We are absolutely delighted to invite you to join us in Tuscany, Italy for our wedding.</p>
        </section>

        <section class="section content-block">
            <h2>The Stay</h2>
            <br>
            <p>We have booked <a href="https://www.tenutadipapena.it/" target="_blank">Tenuta di Papena</a>, a stunning small villa in the heart of Tuscany. With an intimate guest list of just over 20, we can comfortably fit everyone in their own space.</p>
            
            <div class="img-grid stay-img-grid">
                <!-- Replace src with Tenuta-1.webp -->
                <img src="tenuta-1.webp" alt="Tenuta Villa View 1">
                <!-- Replace src with tenuta-2.webp -->
                <img src="tenuta-2.webp" alt="Tenuta Villa View 2">
            </div>

            <!-- Reworked stay dates so titles can be forced onto their own line on mobile -->
            <p class="stay-line"><strong>Check-in:</strong> <span class="stay-detail">Monday, September 14th, 2026</span></p>
            <p class="stay-line"><strong>The Wedding:</strong> <span class="stay-detail">Tuesday, September 15th, 2026</span></p>
            <p class="stay-line"><strong>Check-out:</strong> <span class="stay-detail">Thursday, September 17th, 2026</span></p>
            <br>
            <p>You are welcome to join us for all or just a portion of the stay. We have meals planned and will ensure light snacks and drinks are available in your room. We will share specific room details closer to the date.</p>
            <br>
            <p class="note">Please note: Tenuta di Papena is remote. While we will be stocked up, please plan ahead if you need specific personal items. Don't forget a bathing suit for the pool!</p>

            <!-- Dynamic content for Singles -->
            <div id="plus-one-info" class="hidden-content">
                <strong>A note for you:</strong> You are welcome to plan your own alternative accommodations if you prefer, or if you wish to bring a plus one not listed on this invite.
            </div>
        </section>

        <section class="section">
            <h2>Dress Code</h2>
            <p>Alex and Jeff will be wearing pastel <span class="mobile-break">white and green suits.</span></p>
            
             <div class="outfit-image-container">
                 <!-- Replace src with outfits.jpg -->
                 <img src="outfits.jpg" class="outfit-img" alt="Dress code inspiration">
             </div>

            <!-- Single line with mobile break; Canadian spelling "colours" -->
            <div style="max-width:500px; margin: 0 auto; text-align:center;">
                <strong>Semi formal, light natural <span class="mobile-break">colours or florals.</span></strong>
            </div>
        </section>

        <section class="section content-block" style="background-color: var(--accent-light); border: none;">
            <h3>Your presence is the only gift we require.</h3>
            <p style="margin-top:10px;">Flights are expensive, so please, no gifts!</p>
        </section>

        <section class="section">
            <h2>Travel Details</h2>
            <div class="img-grid travel-grid">
                <div>
                    <h3>Getting There</h3>
                    <p>It is most convenient to fly into <strong>Rome</strong>.</p>
                    <p class="note">A bus is scheduled to take guests from Rome to Tenuta di Papena on Monday morning.</p>
                </div>
                <div>
                    <h3>Getting Back</h3>
                    <p>Alex and Jeff will be making their way to Florence.</p>
                    <p class="note">A bus is scheduled to take guests from Tenuta di Papena back to Rome on Thursday afternoon.</p>
                </div>
            </div>
            <p><em>Please let us know once you have confirmed your flight details or any alternative arrangements!</em></p>
        </section>

        <section class="section content-block">
            <h2>Itinerary</h2>
            <!-- Much smaller note -->
            <p class="itinerary-note">* Likely to change</p>
             <ul class="timeline">
                 <!-- Monday -->
                 <li>
                    <strong>Monday Evening</strong>
                    Welcome Pizza Party
                 </li>
                 
                 <!-- Tuesday -->
                 <li>
                    <strong>Tuesday Morning</strong>
                    Simple Breakfast (Help Yourself)
                 </li>
                 <li>
                    <strong>Tuesday Midday</strong>
                    Bus to Ceremony
                 </li>
                 <li>
                    <strong>Tuesday Afternoon</strong>
                    Ceremony @ Abbey of San Galgano
                 </li>
             </ul>
             
             <div class="img-single">
                 <!-- Replace src with abbey.webp -->
                 <img src="abbey.webp" alt="Abbey of San Galgano">
             </div>

             <ul class="timeline">
                 <li>
                    <strong>Tuesday Afternoon</strong>
                    Aperitif
                 </li>
                 <li>
                    <strong>Tuesday Evening</strong>
                    Dinner
                 </li>
                <li>
                    <strong>Tuesday Late Evening</strong>
                    Drinks, Dancing, Dessert & Late Night Snacks
                </li>

                 <!-- Wednesday -->
                 <li>
                    <strong>Wednesday Morning</strong>
                    Group Brunch
                 </li>
                 <li>
                    <strong>Wednesday Midday</strong>
                    Bus to Siena
                 </li>
                 <li>
                    <strong>Wednesday Afternoon</strong>
                    Lunch & Afternoon in Siena
                 </li>
             </ul>

             <div class="img-single">
                 <!-- Replace src with siena.jpg -->
                 <img src="siena.jpg" alt="Siena">
             </div>

             <ul class="timeline">
                 <li>
                    <strong>Wednesday Evening</strong>
                    Dinner @ Winery
                 </li>
                 <li>
                    <strong>Wednesday Night</strong>
                    Bus to Venue
                 </li>

                 <!-- Thursday -->
                 <li>
                    <strong>Thursday Morning</strong>
                    Simple Breakfast (Help Yourself)
                 </li>
             </ul>
        </section>

        <section class="section">
            <!-- Embedded Google Form directly on the page -->
            <div id="rsvp-embed" class="rsvp-embed" aria-hidden="false">
                <iframe id="rsvp-iframe" src="" title="RSVP Form">Loadingâ€¦</iframe>
            </div>
        </section>

        <footer>
            <p>Alex & Jeff 2026 &bull; See you in Italy!</p>
        </footer>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // 1. Guest Data
        const guestList = {
            "A3B7CD": { name: "Jeff & Alex", type: "couple" },
            "EF6GH2": { name: "Jim & Michelle", type: "couple" },
            "J8KMN9": { name: "Brad, Jane, Charlotte, Josie, & Susan", type: "group" },
            "P2Q4RZ": { name: "Emily & Marek", type: "couple" },
            "S7T3V8": { name: "Jes & Michael", type: "couple" },
            "W9X2YA": { name: "Max", type: "single" }, // Single
            "B4C8DF": { name: "Eric & Karl", type: "couple" },
            "G5H7JK": { name: "Jacob", type: "single" }, // Single
            "M3N9PA": { name: "AlexW", type: "single" }, // Single
            "Q6R8TB": { name: "Harrison", type: "single" }, // Single
            "X3YP7Z": { name: "Bronwynne & Calvin", type: "couple" },
            "Z7W4X2": { name: "Marlee & Chris", type: "couple" },
            "T8V6W9": { name: "Jared & Chad", type: "couple" },
            "H2K7M3": { name: "Patrick & Serena", type: "couple" }
        };

        // 2. Setup Configuration
        // IMPORTANT: Replace the empty string below with your deployed Google Apps Script URL (See instructions)
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbybmqjq069jxIeAKc3IqT3YwgR_nBYepMhhLDt3l2BZW5WB28KRNXrScOXjmBQUoTlp/exec"; 

        // IMPORTANT: Replace 'entry.XXXXXX' with the actual Field ID from your Google Form (See instructions)
        const GOOGLE_FORM_FIELD_ID = "entry.746382756"; // Placeholder ID
        // Set the EMBED base URL for your Google Form. It should look like:
        // https://docs.google.com/forms/d/e/<FORM_ID>/viewform
        const GOOGLE_FORM_BASE_URL = "https://docs.google.com/forms/d/e/1FAIpQLSdjxjp1i5dcv525mihl83ZEXIHFIOD1yalN4JarpCGbIoV6KA/viewform"; // Placeholder extracted from your link

        // 3. Logic to Parse URL and Render Page
        const urlParams = new URLSearchParams(window.location.search);
        const guestId = urlParams.get('id');

        if (guestId && guestList[guestId.trim()]) {
            // Valid Guest
            const id = guestId.trim();
            const guest = guestList[id];

            // Hide Login Overlay
            document.getElementById('login-overlay').style.display = 'none';

            // Populate Greeting
            document.getElementById('greeting-text').innerText = `Hello ${guest.name},`;

            // Handle Conditional Text for Singles
            if (guest.type === "single") {
                document.getElementById('plus-one-info').style.display = 'block';
            }

            // Update RSVP: set iframe src to the embedded form, prefill the ID if we have field id & guest id
            // Build embed URL
            (function setRsvpIframe() {
                // Start from base URL
                let embedUrl = GOOGLE_FORM_BASE_URL || '';
                if (!embedUrl) {
                    // Fallback to a generic viewform if not configured
                    embedUrl = 'https://docs.google.com/forms/d/e/1FAIpQLSdXg-xxxxxxxx/viewform';
                }
                // Ensure embedded=true is present
                embedUrl += (embedUrl.includes('?') ? '&' : '?') + 'embedded=true';

                // Append prefill parameter if available
                if (id && GOOGLE_FORM_FIELD_ID) {
                    embedUrl += `&${encodeURIComponent(GOOGLE_FORM_FIELD_ID)}=${encodeURIComponent(id)}`;
                }
                document.getElementById('rsvp-iframe').src = embedUrl;
            })();

            // Log the visit to Google Sheets
            logVisitToSheet(id);

        } else {
            // No ID or Invalid ID - Show Overlay (Default)
            // Pre-fill iframe with a generic embed (no id)
            (function setGenericRsvpIframe() {
                let embedUrl = GOOGLE_FORM_BASE_URL || 'https://docs.google.com/forms/d/e/1FAIpQLSdXg-xxxxxxxx/viewform';
                embedUrl += (embedUrl.includes('?') ? '&' : '?') + 'embedded=true';
                document.getElementById('rsvp-iframe').src = embedUrl;
            })();
        }

        // 4. Handle Manual Login
        function submitId() {
            const inputVal = document.getElementById('guest-id-input').value.trim().toUpperCase();
            if (guestList[inputVal]) {
                // Reload page with ID
                window.location.search = `?id=${inputVal}`;
            } else {
                document.getElementById('error-msg').style.display = 'block';
            }
        }

        // 5. Function to Log to Sheets via Apps Script
        function logVisitToSheet(id) {
            if (!GOOGLE_SCRIPT_URL) return; // Skip if not set up

            fetch(GOOGLE_SCRIPT_URL + `?id=${id}`)
                .then(response => console.log("Visit logged"))
                .catch(error => console.error("Error logging visit:", error));
        }
    </script>
</body>
</html>